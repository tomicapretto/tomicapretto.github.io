<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>¿Los rookies mejoran con cada lanzamiento? Jugando Bayes con datos de tiros libres de la NBA – Tomi Capretto</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../imgs/mate.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-7443f2a2c903350aebfc1ad1b5756fe3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-78XRDSRQC8"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-78XRDSRQC8', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Tomi Capretto</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#los-datos" id="toc-los-datos" class="nav-link active" data-scroll-target="#los-datos">Los datos</a></li>
  <li><a href="#modelo-agrupado" id="toc-modelo-agrupado" class="nav-link" data-scroll-target="#modelo-agrupado">Modelo agrupado</a></li>
  <li><a href="#modelo-parcialmente-agrupado" id="toc-modelo-parcialmente-agrupado" class="nav-link" data-scroll-target="#modelo-parcialmente-agrupado">Modelo parcialmente agrupado</a></li>
  <li><a href="#comentarios-finales" id="toc-comentarios-finales" class="nav-link" data-scroll-target="#comentarios-finales">Comentarios finales</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">¿Los rookies mejoran con cada lanzamiento? Jugando Bayes con datos de tiros libres de la NBA</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Fecha de publicación</div>
    <div class="quarto-title-meta-contents">
      <p class="date">26 de septiembre de 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="afa71134" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytensor.tensor <span class="im">as</span> pt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>c_orange <span class="op">=</span> <span class="st">"#f08533"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>c_blue <span class="op">=</span> <span class="st">"#3b78b0"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>c_red <span class="op">=</span> <span class="st">"#d1352c"</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Mientras <em>scrapeaba</em> datos sobre los tiros libres de los <em>rookies</em> en la NBA durante la temporada 2024-25, me encontré con <a href="https://link.springer.com/article/10.1007/s12662-020-00646-x">este artículo</a>, donde se concluye que existe un efecto de “precalentamiento”: los jugadores de básquet tienden a fallar más los primeros disparos que el resto. El hallazgo me pareció interesante y lógico, y empecé a preguntarme si valía la pena realizar un análisis similar con los datos que estaba recolectando. Y bueno, acá estamos.</p>
<section id="los-datos" class="level2">
<h2 class="anchored" data-anchor-id="los-datos">Los datos</h2>
<p>El siguiente <em>data frame</em> contiene información sobre los tiros libres realizados por los <em>rookies</em> de la temporada 2024-25 de la NBA. En este caso, las columnas relevantes son la identificación del jugador (<code>player_id</code>), el orden del disparo (<code>description</code>) y si el lanzamiento fue convertido (<code>success</code>).</p>
<div id="ccf5ecd3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    pl.read_parquet(<span class="st">"../data.parquet"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"game_date"</span>, <span class="st">"matchup"</span>, <span class="st">"player_id"</span>, <span class="st">"player_name"</span>, <span class="st">"description"</span>, <span class="st">"success"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3_722, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">game_date</th>
<th data-quarto-table-cell-role="th">matchup</th>
<th data-quarto-table-cell-role="th">player_id</th>
<th data-quarto-table-cell-role="th">player_name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">success</th>
</tr>
<tr class="even">
<th>date</th>
<th>str</th>
<th>i32</th>
<th>str</th>
<th>str</th>
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2025-04-05</td>
<td>"MEM @ DET"</td>
<td>1641744</td>
<td>"Edey, Zach"</td>
<td>"Free Throw 1 of 2"</td>
<td>false</td>
</tr>
<tr class="even">
<td>2025-04-05</td>
<td>"MEM @ DET"</td>
<td>1641744</td>
<td>"Edey, Zach"</td>
<td>"Free Throw 2 of 2"</td>
<td>false</td>
</tr>
<tr class="odd">
<td>2025-01-18</td>
<td>"PHI @ IND"</td>
<td>1641737</td>
<td>"Bona, Adem"</td>
<td>"Free Throw 1 of 1"</td>
<td>true</td>
</tr>
<tr class="even">
<td>2025-01-18</td>
<td>"PHI @ IND"</td>
<td>1641737</td>
<td>"Bona, Adem"</td>
<td>"Free Throw 1 of 2"</td>
<td>false</td>
</tr>
<tr class="odd">
<td>2025-01-18</td>
<td>"PHI @ IND"</td>
<td>1641737</td>
<td>"Bona, Adem"</td>
<td>"Free Throw 2 of 2"</td>
<td>true</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2024-11-06</td>
<td>"MEM vs. LAL"</td>
<td>1642530</td>
<td>"Kawamura, Yuki"</td>
<td>"Free Throw 1 of 2"</td>
<td>true</td>
</tr>
<tr class="even">
<td>2024-11-06</td>
<td>"MEM vs. LAL"</td>
<td>1642530</td>
<td>"Kawamura, Yuki"</td>
<td>"Free Throw 2 of 2"</td>
<td>true</td>
</tr>
<tr class="odd">
<td>2025-03-12</td>
<td>"MEM vs. UTA"</td>
<td>1641744</td>
<td>"Edey, Zach"</td>
<td>"Free Throw 1 of 1"</td>
<td>false</td>
</tr>
<tr class="even">
<td>2024-11-22</td>
<td>"NOP vs. GSW"</td>
<td>1641810</td>
<td>"Reeves, Antonio"</td>
<td>"Free Throw 1 of 2"</td>
<td>true</td>
</tr>
<tr class="odd">
<td>2024-11-22</td>
<td>"NOP vs. GSW"</td>
<td>1641810</td>
<td>"Reeves, Antonio"</td>
<td>"Free Throw 2 of 2"</td>
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>En la NBA, los tiros libres pueden darse en series de 1, 2 o 3 intentos. Nuestra primera tarea es mapear los valores de <code>description</code> a un valor numérico que represente el orden del disparo dentro de su serie.</p>
<div id="59dbdd88" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>throw_order <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw 1 of 1"</span>: <span class="dv">1</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw 1 of 2"</span>: <span class="dv">1</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw 1 of 3"</span>: <span class="dv">1</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw 2 of 2"</span>: <span class="dv">2</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw 2 of 3"</span>: <span class="dv">2</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw 3 of 3"</span>: <span class="dv">3</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw Clear Path 1 of 2"</span>: <span class="dv">1</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw Clear Path 2 of 2"</span>: <span class="dv">2</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw Flagrant 1 of 1"</span>: <span class="dv">1</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw Flagrant 1 of 2"</span>: <span class="dv">1</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw Flagrant 2 of 2"</span>: <span class="dv">2</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Free Throw Technical"</span>: <span class="dv">1</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.with_columns(</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"description"</span>).replace_strict(throw_order, return_dtype<span class="op">=</span>pl.Int64).alias(<span class="st">"order"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3_722, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">game_date</th>
<th data-quarto-table-cell-role="th">matchup</th>
<th data-quarto-table-cell-role="th">player_id</th>
<th data-quarto-table-cell-role="th">player_name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">success</th>
<th data-quarto-table-cell-role="th">order</th>
</tr>
<tr class="even">
<th>date</th>
<th>str</th>
<th>i32</th>
<th>str</th>
<th>str</th>
<th>bool</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2025-04-05</td>
<td>"MEM @ DET"</td>
<td>1641744</td>
<td>"Edey, Zach"</td>
<td>"Free Throw 1 of 2"</td>
<td>false</td>
<td>1</td>
</tr>
<tr class="even">
<td>2025-04-05</td>
<td>"MEM @ DET"</td>
<td>1641744</td>
<td>"Edey, Zach"</td>
<td>"Free Throw 2 of 2"</td>
<td>false</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2025-01-18</td>
<td>"PHI @ IND"</td>
<td>1641737</td>
<td>"Bona, Adem"</td>
<td>"Free Throw 1 of 1"</td>
<td>true</td>
<td>1</td>
</tr>
<tr class="even">
<td>2025-01-18</td>
<td>"PHI @ IND"</td>
<td>1641737</td>
<td>"Bona, Adem"</td>
<td>"Free Throw 1 of 2"</td>
<td>false</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2025-01-18</td>
<td>"PHI @ IND"</td>
<td>1641737</td>
<td>"Bona, Adem"</td>
<td>"Free Throw 2 of 2"</td>
<td>true</td>
<td>2</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2024-11-06</td>
<td>"MEM vs. LAL"</td>
<td>1642530</td>
<td>"Kawamura, Yuki"</td>
<td>"Free Throw 1 of 2"</td>
<td>true</td>
<td>1</td>
</tr>
<tr class="even">
<td>2024-11-06</td>
<td>"MEM vs. LAL"</td>
<td>1642530</td>
<td>"Kawamura, Yuki"</td>
<td>"Free Throw 2 of 2"</td>
<td>true</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2025-03-12</td>
<td>"MEM vs. UTA"</td>
<td>1641744</td>
<td>"Edey, Zach"</td>
<td>"Free Throw 1 of 1"</td>
<td>false</td>
<td>1</td>
</tr>
<tr class="even">
<td>2024-11-22</td>
<td>"NOP vs. GSW"</td>
<td>1641810</td>
<td>"Reeves, Antonio"</td>
<td>"Free Throw 1 of 2"</td>
<td>true</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2024-11-22</td>
<td>"NOP vs. GSW"</td>
<td>1641810</td>
<td>"Reeves, Antonio"</td>
<td>"Free Throw 2 of 2"</td>
<td>false</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Podemos observar que los primeros intentos suelen fallarse con mayor frecuencia que los segundos, y que estos, a su vez, se fallan más que los terceros.</p>
<div id="6fa81d15" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_summary <span class="op">=</span> (</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"order"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"success"</span>).<span class="bu">sum</span>().alias(<span class="st">"y"</span>), pl.<span class="bu">len</span>().alias(<span class="st">"n"</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    .with_columns((pl.col(<span class="st">"y"</span>) <span class="op">/</span> pl.col(<span class="st">"n"</span>)).alias(<span class="st">"p"</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"order"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>df_summary</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">order</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">p</th>
</tr>
<tr class="even">
<th>i64</th>
<th>u32</th>
<th>u32</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1435</td>
<td>2069</td>
<td>0.693572</td>
</tr>
<tr class="even">
<td>2</td>
<td>1227</td>
<td>1625</td>
<td>0.755077</td>
</tr>
<tr class="odd">
<td>3</td>
<td>23</td>
<td>28</td>
<td>0.821429</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="modelo-agrupado" class="level2">
<h2 class="anchored" data-anchor-id="modelo-agrupado">Modelo agrupado</h2>
<p>Como primer paso, utilizamos un modelo que agrupa los disparos de todos los jugadores, los considera equivalentes, más de lo mismo. Definimos <span class="math inline">\(Y_1\)</span> como la cantidad de aciertos en primeros disparos y <span class="math inline">\(Y_2\)</span> como la cantidad de aciertos en segundos disparos. Luego, <span class="math inline">\(\pi_1\)</span> representa la probabilidad de acertar en un primer intento y <span class="math inline">\(\pi_2\)</span> en un segundo.</p>
<p><span class="math display">\[
\begin{aligned}
Y_1 &amp;\sim \text{Binomial}(N_1, \pi_1) \\
Y_2 &amp;\sim \text{Binomial}(N_2, \pi_2) \\
\pi_1 &amp;\sim \text{Beta}(4, 2) \\
\pi_2 &amp;\sim \text{Beta}(4, 2) \\
\end{aligned}
\]</span></p>
<p>En PyMC, tenemos:</p>
<div id="d9632925" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_summary.head(<span class="dv">2</span>)[<span class="st">"y"</span>].to_numpy()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> df_summary.head(<span class="dv">2</span>)[<span class="st">"n"</span>].to_numpy()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>{<span class="st">"order"</span>: [<span class="dv">1</span>, <span class="dv">2</span>]}) <span class="im">as</span> model:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    pi <span class="op">=</span> pm.Beta(<span class="st">"pi"</span>, alpha<span class="op">=</span><span class="dv">4</span>, beta<span class="op">=</span><span class="dv">2</span>, dims<span class="op">=</span><span class="st">"order"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> pm.Binomial(<span class="st">"y"</span>, p<span class="op">=</span>pi, n<span class="op">=</span>n, observed<span class="op">=</span>y, dims<span class="op">=</span><span class="st">"order"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    idata <span class="op">=</span> pm.sample(chains<span class="op">=</span><span class="dv">4</span>, random_seed<span class="op">=</span><span class="dv">1211</span>, nuts_sampler<span class="op">=</span><span class="st">"nutpie"</span>, progressbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>model.to_graphviz()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Calculamos <span class="math inline">\(\delta\)</span> como la diferencia entre <span class="math inline">\(\pi_2\)</span> y <span class="math inline">\(\pi_1\)</span>, y analizamos las distribuciones marginales <em>a posteriori</em>.</p>
<p>En primer lugar, los diagnósticos no indican problemas en el muestreo: <span class="math inline">\(\hat{R}\)</span> cercano a 1, tamaños efectivos de muestra adecuados, etc.</p>
<div id="da64b84f" class="cell center-table-70" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>idata.posterior[<span class="st">"delta"</span>] <span class="op">=</span> idata.posterior[<span class="st">"pi"</span>].sel(order<span class="op">=</span><span class="dv">2</span>) <span class="op">-</span> idata.posterior[<span class="st">"pi"</span>].sel(order<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>az.summary(idata, var_names<span class="op">=</span>[<span class="st">"pi"</span>, <span class="st">"delta"</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sd</th>
<th data-quarto-table-cell-role="th">hdi_3%</th>
<th data-quarto-table-cell-role="th">hdi_97%</th>
<th data-quarto-table-cell-role="th">mcse_mean</th>
<th data-quarto-table-cell-role="th">mcse_sd</th>
<th data-quarto-table-cell-role="th">ess_bulk</th>
<th data-quarto-table-cell-role="th">ess_tail</th>
<th data-quarto-table-cell-role="th">r_hat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">pi[1]</td>
<td>0.694</td>
<td>0.010</td>
<td>0.673</td>
<td>0.712</td>
<td>0.0</td>
<td>0.0</td>
<td>4040.0</td>
<td>2880.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pi[2]</td>
<td>0.754</td>
<td>0.011</td>
<td>0.733</td>
<td>0.773</td>
<td>0.0</td>
<td>0.0</td>
<td>3996.0</td>
<td>2737.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">delta</td>
<td>0.061</td>
<td>0.015</td>
<td>0.030</td>
<td>0.088</td>
<td>0.0</td>
<td>0.0</td>
<td>4193.0</td>
<td>2918.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Si nos enfocamos en la distribución <em>a posteriori</em> de <span class="math inline">\(\delta\)</span>, podemos ver que la probabilidad de que <span class="math inline">\(\delta\)</span> sea mayor a 0 es igual a 1.</p>
<p>Así, llegamos a nuestra primera gran conclusión: efectivamente, la probabilidad de acertar en el segundo intento es mayor que en el primero. De hecho, la probabilidad de acierto se incrementa, en promedio, un 6 %. Y, con un alto grado de certeza, podemos afirmar que esta mejora se encuentra entre el 3 % y el 9 %.</p>
<div id="6c65a1c7" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modelo-parcialmente-agrupado" class="level2">
<h2 class="anchored" data-anchor-id="modelo-parcialmente-agrupado">Modelo parcialmente agrupado</h2>
<p>El modelo anterior solo nos permite concluir que es más probable que un <em>rookie</em> acierte un segundo lanzamiento que un primero (y cuantificar la magnitud de la diferencia). Sin embargo, no podemos extraer conclusiones sobre jugadores individuales. Por ejemplo, no sabemos si este fenómeno de “precalentamiento” se presenta en todos ellos, ni si su intensidad varía de un jugador a otro.</p>
<p>Una alternativa sería ajustar pares de modelos beta-binomiales como los anteriores para cada jugador. Lamentablemente, dado que la cantidad de disparos varía entre apenas uno y unas pocas centenas, las distribuciones <em>a posteriori</em> pueden resultar extremadamente inciertas en algunos casos o excesivamente confiadas en otros.</p>
<p>Así llegamos a la alternativa bayesiana por excelencia: el modelo jerárquico. Bajo este enfoque, cada jugador tiene su propia probabilidad de acierto, pero dicha probabilidad proviene de una distribución común compartida con el resto. De este modo, las estimaciones son más estables y se evita el sobreajuste a los datos particulares de cada jugador, ya que la distribución <em>a posteriori</em> de cada uno está influenciada, en cierta medida, por la información del resto.</p>
<p>Los datos que necesitamos son la cantidad de disparos y aciertos en el primer y segundo intento para cada jugador. Por simplicidad, consideramos únicamente a los jugadores que realizaron al menos una serie de dos tiros libres.</p>
<div id="67ef624d" class="cell center-table-40" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_agg <span class="op">=</span> (</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"player_id"</span>, <span class="st">"order"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"success"</span>).<span class="bu">sum</span>().alias(<span class="st">"y"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        pl.<span class="bu">len</span>().alias(<span class="st">"n"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"player_id"</span>, <span class="st">"order"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>selected_ids <span class="op">=</span> (</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    df_agg</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"order"</span>) <span class="op">==</span> <span class="dv">2</span>, pl.col(<span class="st">"n"</span>) <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    .get_column(<span class="st">"player_id"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    .unique()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    .to_list()</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>df_model <span class="op">=</span> (</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    df_agg</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"player_id"</span>).is_in(selected_ids), pl.col(<span class="st">"order"</span>) <span class="op">&lt;</span> <span class="dv">3</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"player_id"</span>, <span class="st">"order"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>df_model</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (184, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">player_id</th>
<th data-quarto-table-cell-role="th">order</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">n</th>
</tr>
<tr class="even">
<th>i32</th>
<th>i64</th>
<th>u32</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1630283</td>
<td>1</td>
<td>1</td>
<td>5</td>
</tr>
<tr class="even">
<td>1630283</td>
<td>2</td>
<td>5</td>
<td>5</td>
</tr>
<tr class="odd">
<td>1630542</td>
<td>1</td>
<td>4</td>
<td>5</td>
</tr>
<tr class="even">
<td>1630542</td>
<td>2</td>
<td>4</td>
<td>5</td>
</tr>
<tr class="odd">
<td>1630545</td>
<td>1</td>
<td>9</td>
<td>12</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>1642502</td>
<td>2</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>1642505</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1642505</td>
<td>2</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>1642530</td>
<td>1</td>
<td>4</td>
<td>5</td>
</tr>
<tr class="odd">
<td>1642530</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>De manera distribucional, podemos representar al modelo de la siguiente manera:</p>
<span class="math display">\[\begin{aligned}
Y_{i1} &amp;\sim \text{Binomial}(N_{i1}, \pi_i) \\
Y_{i2} &amp;\sim \text{Binomial}(N_{i2}, \theta_i) \\ \\

&amp; \text{--- P(Free throw 1 is made) ---} \\

\pi_i &amp;\sim \text{Beta}(\mu_\pi, \kappa_\pi) \\
\mu_\pi &amp;\sim \text{Beta}(4, 2) \\
\kappa_\pi &amp;\sim \text{InverseGamma}(0.5 \cdot 15, 0.5 \cdot 15 \cdot 10) \\ \\

&amp; \text{--- P(Free throw 2 is made) --- } \\

\theta_i &amp;= \pi_i + \delta_i \\
\delta_i &amp;\sim \text{Normal}(\mu_\delta, \sigma^2_\delta) \\
\mu_\delta &amp;\sim \text{Normal}(0, 0.15^2) \\
\sigma^2_\delta &amp;\sim \text{InverseGamma}(0.5 \cdot 30, 0.5 \cdot 30 \cdot 0.05) \\
\end{aligned}\]</span>
<p>donde <span class="math inline">\(i \in \{1, \dots, 92\}\)</span> indexa a los jugadores.</p>
<p>En otras palabras, modelizamos la probabilidad de acierto en el segundo intento como la suma de la probabilidad de acierto en el primero (<span class="math inline">\(\pi_i\)</span>) y un diferencial específico de cada jugador (<span class="math inline">\(\delta_i\)</span>).</p>
<p>Las distribuciones <em>a priori</em> para <span class="math inline">\(\mu_\pi\)</span> y <span class="math inline">\(\mu_\delta\)</span> son levemente y moderadamente informativas, respectivamente. Por su parte, los <em>priors</em> asignados a <span class="math inline">\(\kappa_\pi\)</span> y <span class="math inline">\(\sigma^2_\delta\)</span> también son moderadamente informativos, aunque en este caso su función principal es favorecer la estabilidad del muestreo del <em>posterior</em>.</p>
<div id="bc932449" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="annotated-cell-8"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-8-1" class="code-annotation-target"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a>y_1 <span class="op">=</span> df_model.<span class="bu">filter</span>(pl.col(<span class="st">"order"</span>) <span class="op">==</span> <span class="dv">1</span>)[<span class="st">"y"</span>].to_numpy()</span>
<span id="annotated-cell-8-2"><a href="#annotated-cell-8-2" aria-hidden="true" tabindex="-1"></a>y_2 <span class="op">=</span> df_model.<span class="bu">filter</span>(pl.col(<span class="st">"order"</span>) <span class="op">==</span> <span class="dv">2</span>)[<span class="st">"y"</span>].to_numpy()</span>
<span id="annotated-cell-8-3"><a href="#annotated-cell-8-3" aria-hidden="true" tabindex="-1"></a>n_1 <span class="op">=</span> df_model.<span class="bu">filter</span>(pl.col(<span class="st">"order"</span>) <span class="op">==</span> <span class="dv">1</span>)[<span class="st">"n"</span>].to_numpy()</span>
<span id="annotated-cell-8-4"><a href="#annotated-cell-8-4" aria-hidden="true" tabindex="-1"></a>n_2 <span class="op">=</span> df_model.<span class="bu">filter</span>(pl.col(<span class="st">"order"</span>) <span class="op">==</span> <span class="dv">2</span>)[<span class="st">"n"</span>].to_numpy()</span>
<span id="annotated-cell-8-5"><a href="#annotated-cell-8-5" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-8-6" class="code-annotation-target"><a href="#annotated-cell-8-6" aria-hidden="true" tabindex="-1"></a>player_ids <span class="op">=</span> df_model[<span class="st">"player_id"</span>].unique(maintain_order<span class="op">=</span><span class="va">True</span>)</span>
<span id="annotated-cell-8-7"><a href="#annotated-cell-8-7" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="bu">len</span>(player_ids)</span>
<span id="annotated-cell-8-8"><a href="#annotated-cell-8-8" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> {<span class="st">"player"</span>: player_ids}</span>
<span id="annotated-cell-8-9"><a href="#annotated-cell-8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-8-10"><a href="#annotated-cell-8-10" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> model_h:</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-8-11" class="code-annotation-target"><a href="#annotated-cell-8-11" aria-hidden="true" tabindex="-1"></a>    pi_mu <span class="op">=</span> pm.Beta(<span class="st">"pi_mu"</span>, alpha<span class="op">=</span><span class="dv">4</span>, beta<span class="op">=</span><span class="dv">2</span>)</span>
<span id="annotated-cell-8-12"><a href="#annotated-cell-8-12" aria-hidden="true" tabindex="-1"></a>    pi_kappa <span class="op">=</span> pm.InverseGamma(<span class="st">"pi_kappa"</span>, alpha<span class="op">=</span><span class="fl">0.5</span> <span class="op">*</span> <span class="dv">15</span>, beta<span class="op">=</span><span class="fl">0.5</span> <span class="op">*</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">10</span>)</span>
<span id="annotated-cell-8-13"><a href="#annotated-cell-8-13" aria-hidden="true" tabindex="-1"></a>    pi_alpha <span class="op">=</span> pi_mu <span class="op">*</span> pi_kappa</span>
<span id="annotated-cell-8-14"><a href="#annotated-cell-8-14" aria-hidden="true" tabindex="-1"></a>    pi_beta <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> pi_mu) <span class="op">*</span> pi_kappa</span>
<span id="annotated-cell-8-15"><a href="#annotated-cell-8-15" aria-hidden="true" tabindex="-1"></a>    pi <span class="op">=</span> pm.Beta(<span class="st">"pi"</span>, alpha<span class="op">=</span>pi_alpha, beta<span class="op">=</span>pi_beta, dims<span class="op">=</span><span class="st">"player"</span>)</span>
<span id="annotated-cell-8-16"><a href="#annotated-cell-8-16" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-8-17" class="code-annotation-target"><a href="#annotated-cell-8-17" aria-hidden="true" tabindex="-1"></a>    delta_mu <span class="op">=</span> pm.Normal(<span class="st">"delta_mu"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="fl">0.15</span>)</span>
<span id="annotated-cell-8-18"><a href="#annotated-cell-8-18" aria-hidden="true" tabindex="-1"></a>    delta_sigma <span class="op">=</span> pm.InverseGamma(<span class="st">"delta_sigma^2"</span>, <span class="fl">0.5</span> <span class="op">*</span> <span class="dv">30</span>, <span class="fl">0.5</span> <span class="op">*</span> <span class="dv">30</span> <span class="op">*</span> <span class="fl">0.05</span> <span class="op">**</span> <span class="dv">2</span>) <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="annotated-cell-8-19"><a href="#annotated-cell-8-19" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> pm.Normal(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-8-20" class="code-annotation-target"><a href="#annotated-cell-8-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"delta"</span>, mu<span class="op">=</span>delta_mu, sigma<span class="op">=</span>delta_sigma, dims<span class="op">=</span><span class="st">"player"</span>, initval<span class="op">=</span>np.zeros(N)</span>
<span id="annotated-cell-8-21"><a href="#annotated-cell-8-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-8-22" class="code-annotation-target"><a href="#annotated-cell-8-22" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> pm.Deterministic(<span class="st">"theta"</span>, pt.clip(pi <span class="op">+</span> delta, <span class="fl">0.0001</span>, <span class="fl">0.9999</span>), dims<span class="op">=</span><span class="st">"player"</span>)</span>
<span id="annotated-cell-8-23"><a href="#annotated-cell-8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-8-24"><a href="#annotated-cell-8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-8-25"><a href="#annotated-cell-8-25" aria-hidden="true" tabindex="-1"></a>    pm.Binomial(<span class="st">"y_1"</span>, p<span class="op">=</span>pi, n<span class="op">=</span>n_1, observed<span class="op">=</span>y_1, dims<span class="op">=</span><span class="st">"player"</span>)</span>
<span id="annotated-cell-8-26"><a href="#annotated-cell-8-26" aria-hidden="true" tabindex="-1"></a>    pm.Binomial(<span class="st">"y_2"</span>, p<span class="op">=</span>theta, n<span class="op">=</span>n_2, observed<span class="op">=</span>y_2, dims<span class="op">=</span><span class="st">"player"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="1,2,3,4" data-code-annotation="1"><strong>Preparación de datos:</strong> se usan vectores (se podrían haber usado arreglos bidimensionales).</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="6,7,8" data-code-annotation="2"><strong>Preparación de coordenadas:</strong> representan los diferentes jugadores.</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="11,12,13,14,15" data-code-annotation="3"><strong>Construcción de <span class="math inline">\(\pi_i\)</span>:</strong> se asignan <em>priors</em> para la media y la precisión, que luego se transforman en parámetros de escala para usados directamente en <code>pm.Beta</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="17,18,19,21,23" data-code-annotation="4"><strong>Construcción de <span class="math inline">\(\theta_i\)</span>:</strong> se especifica, para cada jugador, un parámetro de diferencia <span class="math inline">\(\delta_i\)</span>.</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="20" data-code-annotation="5"><strong>Uso de <code>initval</code>:</strong> para que el algoritmo de inferencia comience en un punto válido del espacio paramétrico.</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="22" data-code-annotation="6"><strong>Uso de <code>pt.clip</code>:</strong> para asegurarnos que <span class="math inline">\(\pi_i + \delta_i\)</span> se encuentre entre 0 y 1. Esto no afecta al <em>posterior</em>, pero es necesario para inicializar correctamente el algoritmo de muestreo.</span>
</dd>
</dl>
</div>
</div>
<p>Finalmente, así es como se ve una representación gráfica del modelo:</p>
<div id="cd7ff322" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display" data-execution_count="10">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-11-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Gracias a nutpie, es posible obtener muestras fiables del <em>posterior</em> en muy pocos segundos.</p>
<p>Si bien los diagnósticos no se ven tan bien como en el modelo agrupado (lo cual es esperable en modelos jerárquicos), los valores son aceptables y podemos continuar con nuestro análisis.</p>
<div id="e391709d" class="cell center-table-70" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> model_h:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    idata_h <span class="op">=</span> pm.sample(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        chains<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        target_accept<span class="op">=</span><span class="fl">0.99</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        nuts_sampler<span class="op">=</span><span class="st">"nutpie"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        random_seed<span class="op">=</span><span class="dv">1211</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        progressbar<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>az.summary(idata_h, var_names<span class="op">=</span>[<span class="st">"pi_mu"</span>, <span class="st">"pi_kappa"</span>, <span class="st">"delta_mu"</span>, <span class="st">"delta_sigma^2"</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sd</th>
<th data-quarto-table-cell-role="th">hdi_3%</th>
<th data-quarto-table-cell-role="th">hdi_97%</th>
<th data-quarto-table-cell-role="th">mcse_mean</th>
<th data-quarto-table-cell-role="th">mcse_sd</th>
<th data-quarto-table-cell-role="th">ess_bulk</th>
<th data-quarto-table-cell-role="th">ess_tail</th>
<th data-quarto-table-cell-role="th">r_hat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">pi_mu</td>
<td>0.698</td>
<td>0.015</td>
<td>0.670</td>
<td>0.727</td>
<td>0.000</td>
<td>0.000</td>
<td>1063.0</td>
<td>2206.0</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pi_kappa</td>
<td>28.903</td>
<td>9.035</td>
<td>14.499</td>
<td>45.731</td>
<td>0.286</td>
<td>0.278</td>
<td>1001.0</td>
<td>1623.0</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">delta_mu</td>
<td>0.055</td>
<td>0.016</td>
<td>0.027</td>
<td>0.086</td>
<td>0.001</td>
<td>0.000</td>
<td>497.0</td>
<td>910.0</td>
<td>1.01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">delta_sigma^2</td>
<td>0.002</td>
<td>0.001</td>
<td>0.001</td>
<td>0.003</td>
<td>0.000</td>
<td>0.000</td>
<td>1262.0</td>
<td>2006.0</td>
<td>1.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Los <em>posteriors</em> marginales de los parámetros poblacionales son los siguientes:</p>
<div id="31602cfd" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>A simple vista, se observa que, en promedio, la probabilidad de acertar un primer lanzamiento ronda el 70 %, y que los segundos intentos tienen, en promedio, cerca de un 6 % más de probabilidad de ser convertidos. Aunque esto no resulte novedoso, es satisfactorio comprobar que las inferencias obtenidas con el modelo jerárquico son consistentes con los hallazgos anteriores.</p>
<p>Lo realmente interesante de este modelo jerárquico es que nos permite analizar las distribuciones <em>a posteriori</em> de <span class="math inline">\(\pi_i\)</span>, <span class="math inline">\(\theta_i\)</span> y <span class="math inline">\(\delta_i\)</span> a nivel individual, es decir, para cada jugador.</p>
<p>Sin embargo, visualizar estas distribuciones para todos ellos puede resultar poco práctico. Por eso, seleccionamos un subconjunto representativo de jugadores en función de sus valores de <span class="math inline">\(N_1\)</span> (la cantidad de primeros lanzamientos). En concreto, conservamos a los 10 jugadores con mayor <span class="math inline">\(N_1\)</span> y, entre el resto, los ordenamos de menor a mayor y elegimos uno cada dos posiciones para formar una muestra más manejable.</p>
<div id="843351de" class="cell center-table-60" data-execution_count="13">
<div class="cell-output cell-output-display">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (26, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">player_id</th>
<th data-quarto-table-cell-role="th">player_name</th>
<th data-quarto-table-cell-role="th">y_1</th>
<th data-quarto-table-cell-role="th">y_2</th>
<th data-quarto-table-cell-role="th">n_1</th>
<th data-quarto-table-cell-role="th">n_2</th>
</tr>
<tr class="even">
<th>i32</th>
<th>str</th>
<th>u32</th>
<th>u32</th>
<th>u32</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1642264</td>
<td>"Castle, Stephon"</td>
<td>128</td>
<td>121</td>
<td>192</td>
<td>152</td>
</tr>
<tr class="even">
<td>1642274</td>
<td>"Missi, Yves"</td>
<td>63</td>
<td>64</td>
<td>112</td>
<td>92</td>
</tr>
<tr class="odd">
<td>1642259</td>
<td>"Sarr, Alex"</td>
<td>62</td>
<td>50</td>
<td>88</td>
<td>77</td>
</tr>
<tr class="even">
<td>1642268</td>
<td>"Collier, Isaiah"</td>
<td>56</td>
<td>49</td>
<td>85</td>
<td>69</td>
</tr>
<tr class="odd">
<td>1642258</td>
<td>"Risacher, Zaccharie"</td>
<td>55</td>
<td>47</td>
<td>82</td>
<td>62</td>
</tr>
<tr class="even">
<td>1642271</td>
<td>"Filipowski, Kyle"</td>
<td>47</td>
<td>46</td>
<td>81</td>
<td>62</td>
</tr>
<tr class="odd">
<td>1641744</td>
<td>"Edey, Zach"</td>
<td>54</td>
<td>36</td>
<td>76</td>
<td>51</td>
</tr>
<tr class="even">
<td>1642377</td>
<td>"Wells, Jaylen"</td>
<td>62</td>
<td>44</td>
<td>73</td>
<td>56</td>
</tr>
<tr class="odd">
<td>1641842</td>
<td>"Holland II, Ronald"</td>
<td>51</td>
<td>41</td>
<td>70</td>
<td>52</td>
</tr>
<tr class="even">
<td>1642270</td>
<td>"Clingan, Donovan"</td>
<td>33</td>
<td>29</td>
<td>60</td>
<td>44</td>
</tr>
<tr class="odd">
<td>1641824</td>
<td>"Buzelis, Matas"</td>
<td>45</td>
<td>43</td>
<td>59</td>
<td>49</td>
</tr>
<tr class="even">
<td>1642273</td>
<td>"George, Kyshawn"</td>
<td>39</td>
<td>31</td>
<td>51</td>
<td>42</td>
</tr>
<tr class="odd">
<td>1642266</td>
<td>"Walter, Ja'Kobe"</td>
<td>34</td>
<td>32</td>
<td>47</td>
<td>36</td>
</tr>
<tr class="even">
<td>1642347</td>
<td>"Shead, Jamal"</td>
<td>32</td>
<td>20</td>
<td>42</td>
<td>26</td>
</tr>
<tr class="odd">
<td>1641783</td>
<td>"da Silva, Tristan"</td>
<td>29</td>
<td>26</td>
<td>35</td>
<td>28</td>
</tr>
<tr class="even">
<td>1642272</td>
<td>"McCain, Jared"</td>
<td>23</td>
<td>23</td>
<td>28</td>
<td>25</td>
</tr>
<tr class="odd">
<td>1642348</td>
<td>"Edwards, Justin"</td>
<td>17</td>
<td>15</td>
<td>24</td>
<td>22</td>
</tr>
<tr class="even">
<td>1641810</td>
<td>"Reeves, Antonio"</td>
<td>16</td>
<td>12</td>
<td>21</td>
<td>14</td>
</tr>
<tr class="odd">
<td>1631232</td>
<td>"Brooks Jr., Keion"</td>
<td>12</td>
<td>10</td>
<td>17</td>
<td>13</td>
</tr>
<tr class="even">
<td>1642277</td>
<td>"Furphy, Johnny"</td>
<td>11</td>
<td>7</td>
<td>13</td>
<td>9</td>
</tr>
<tr class="odd">
<td>1641736</td>
<td>"Beekman, Reece"</td>
<td>8</td>
<td>8</td>
<td>11</td>
<td>10</td>
</tr>
<tr class="even">
<td>1642265</td>
<td>"Dillingham, Rob"</td>
<td>4</td>
<td>4</td>
<td>9</td>
<td>6</td>
</tr>
<tr class="odd">
<td>1630574</td>
<td>"Hukporti, Ariel"</td>
<td>2</td>
<td>4</td>
<td>7</td>
<td>6</td>
</tr>
<tr class="even">
<td>1630283</td>
<td>"Kelley, Kylor"</td>
<td>1</td>
<td>5</td>
<td>5</td>
<td>5</td>
</tr>
<tr class="odd">
<td>1641989</td>
<td>"Harkless, Elijah"</td>
<td>2</td>
<td>1</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="even">
<td>1630762</td>
<td>"Wheeler, Phillip"</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Luego, podemos visualizar los <em>posterior</em> marginales de <span class="math inline">\(\pi_i\)</span>, <span class="math inline">\(\theta_i\)</span> y <span class="math inline">\(\delta_i\)</span> para cada jugador seleccionado. Naturalmente, a medida que aumenta la cantidad de disparos observados, las distribuciones <em>a posteriori</em> se vuelven más estrechas, reflejando un mayor nivel de certidumbre.</p>
<p>En todos los casos, incluso cuando <span class="math inline">\(N_1 = 1\)</span> y <span class="math inline">\(N_2 = 1\)</span>, la media <em>a posteriori</em> de <span class="math inline">\(\theta_i\)</span> es mayor que la de <span class="math inline">\(\pi_i\)</span>.</p>
<p>Visto desde otro ángulo, en el panel inferior se observa que la media de <span class="math inline">\(\delta_i\)</span> es siempre mayor que 0. Sin embargo, solo en aquellos casos en los que se registran cientos de lanzamientos puede concluirse, con probabilidad cercana a 1, que los jugadores son efectivamente mejores en los segundos intentos que en los primeros.</p>
<div id="99e20d4c" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Como somos bayesianos y utilizamos métodos de Markov Chain Monte Carlo para obtener muestras del <em>posterior</em>, podemos calcular, para cada jugador, la probabilidad de que <span class="math inline">\(\delta_i\)</span> sea mayor que 0. Con estas probabilidades, es posible construir el siguiente histograma resumen:</p>
<div id="08143049" class="cell" data-execution_count="15">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Luego, sin importar el <em>rookie</em> en el que nos fijemos, siempre concluiremos que tiene una probabilidad entre moderada y alta de ser más efectivo en los segundos lanzamientos que en los primeros.</p>
<p>Para finalizar, comparemos la distribución <em>a posteriori</em> de <span class="math inline">\(\delta\)</span> del modelo agrupado con el <em>posterior</em> de <span class="math inline">\(\mu_\delta\)</span> del modelo parcialmente agrupado, ya que ambas representan la misma cantidad: el diferencial promedio en la probabilidad de acierto entre un segundo y un primer lanzamiento.</p>
<div id="bac92867" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Afortunadamente, no tenemos que reportar sorpresas. Ambos modelos nos conducen hacia conclusiones prácticamente similares sobre el <span class="math inline">\(\delta\)</span> promedio, aunque se puede mencionar que en el modelo jerárquico el <em>posterior</em> se encuentra levemente más regularizado hacia el 0 que en el modelo agrupado. Sin embargo, no debemos olvidar que utilizar un modelo jerárquico nos permitió obtener distribuciones <em>a posteriori</em> para cada jugador individual.</p>
</section>
<section id="comentarios-finales" class="level2">
<h2 class="anchored" data-anchor-id="comentarios-finales">Comentarios finales</h2>
<p>Ejemplos como este son los que me recuerdan por qué el enfoque bayesiano para la modelización estadística me gusta tanto.</p>
<p>Si bien podríamos habernos conformado con una simple prueba de hipótesis, como la que presentan en el <a href="https://link.springer.com/article/10.1007/s12662-020-00646-x">artículo mencionado</a>, la flexibilidad que ofrecen herramientas como PyMC nos permite ir varios pasos más allá. Propusimos un modelo jerárquico (nada trivial), lo implementamos en PyMC, y luego este, junto con nutpie, se encargaron de proporcionarnos muestras del <em>posterior</em>.</p>
<p>A partir de esas muestras, pudimos extraer varias conclusiones interesantes. No solo aquellas a nivel global, que confirman que los jugadores de básquet suelen fallar más en los primeros disparos que en los segundos (en línea con los resultados del artículo), sino también conclusiones específicas para cada jugador.</p>
<p>Y, por encima de todo, más allá de la utilidad práctica del modelo o de los <em>insights</em> que podamos obtener… ¿no es acaso super divertido jugar a la estadística bayesiana?</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiado");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiado");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/tomicapretto\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Tomás Capretto</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>